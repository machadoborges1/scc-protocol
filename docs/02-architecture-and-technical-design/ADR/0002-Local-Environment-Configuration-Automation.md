# ADR 0002: Local Environment Configuration Automation

**Status:** Accepted

**Context:**

The project ecosystem is composed of multiple services (`contracts`, `subgraph`, `offchain`) that depend on a cohesive state, mainly the addresses of the deployed contracts. In a local development environment with Anvil, each blockchain restart generates new addresses for all contracts.

The previous process required developers to manually update the configuration files (`subgraph.yaml`, `offchain/.env`) after each deployment, copying and pasting the new addresses from the terminal log. This manual process was slow, prone to errors (such as pasting the wrong address or forgetting to update a service), and created a frustrating development experience, as was identified during debugging sessions.

**Decision:**

We decided to automate the updating of configuration files for all services that depend on the contract addresses. This decision will be implemented through dedicated "preparation" scripts in each relevant workspace.

1.  **`@scc/subgraph`**: The `prepare:subgraph` script (already existing) will read the deployment artifacts and generate the final `subgraph.yaml` from a `subgraph.template.yaml`.

2.  **`@scc/offchain`**: A new script, `prepare:env`, will be created. It will read the same deployment artifacts and generate the local `.env` file from the `.env.example` template, filling in the contract address variables.

The local development workflow will be standardized to:
1.  Deploy the contracts (`pnpm deploy:contracts`).
2.  Run the preparation scripts (`pnpm prepare:subgraph`, `pnpm prepare:offchain`).
3.  Start the services (`docker compose up`).

**Consequences:**

*   **Positive:**
    *   **Error Reduction:** Eliminates the class of errors caused by out-of-sync environment configurations.
    *   **Improved Developer Experience (DX):** The setup process becomes faster, more deterministic, and less frustrating.
    *   **Single Source of Truth:** The deployment artifacts file (`run-latest.json`) becomes the single source of truth for the configuration of the entire local system.

*   **Negative:**
    *   **Slight Additional Complexity:** Adds new scripts to the project that need to be maintained.
    *   **Tool Dependency:** The flow becomes more dependent on the structure of the `run-latest.json` file generated by Foundry.

We consider that the benefits in productivity and stability far outweigh the disadvantages.
